var text = {
  "status": "success",
  "invoiceType": "hotel",
  "invoiceIssuer": {
    "issuer": "Motel One Berlin-Alexanderplatz",
    "location": {
      "x": 49.0,
      "y": 202.0,
      "width": 21.0,
      "height": 11.0
    }
  },
  "invoiceDate": {
    "date": "2018-11-21",
    "location": {
      "x": 275.0,
      "y": 511.0,
      "width": 63.0,
      "height": 16.0
    }
  },
  "paymentDate": {
    "date": "2018-11-01",
    "location": {
      "x": 57.0,
      "y": 816.0,
      "width": 147.0,
      "height": 18.0
    }
  },
  "invoiceId": {
    "id": "552072342",
    "location": {
      "x": 275.0,
      "y": 535.0,
      "width": 63.0,
      "height": 15.0
    }
  },
  "totalAmount": {
    "amount": 162.0,
    "currency": "€",
    "location": {
      "x": 716.0,
      "y": 731.0,
      "width": 29.0,
      "height": 16.0
    }
  },
  "vatAmounts": [
    {
      "amount": {
        "amount": 3.03,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1009.0,
          "width": 24.0,
          "height": 16.0
        }
      },
      "percentage": {
        "percentage": 19.0,
        "location": {
          "x": 477.0,
          "y": 679.0,
          "width": 34.0,
          "height": 15.0
        }
      }
    },
    {
      "amount": {
        "amount": 9.36,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1033.0,
          "width": 24.0,
          "height": 15.0
        }
      },
      "percentage": {
        "percentage": 7.0,
        "location": {
          "x": 487.0,
          "y": 702.0,
          "width": 27.0,
          "height": 15.0
        }
      }
    },
    {
      "amount": {
        "amount": 9.36,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1033.0,
          "width": 24.0,
          "height": 15.0
        }
      },
      "percentage": {
        "percentage": 7.0,
        "location": {
          "x": 487.0,
          "y": 702.0,
          "width": 27.0,
          "height": 15.0
        }
      }
    },
    {
      "amount": {
        "amount": 3.03,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1009.0,
          "width": 24.0,
          "height": 16.0
        }
      },
      "percentage": {
        "percentage": 19.0,
        "location": {
          "x": 477.0,
          "y": 679.0,
          "width": 34.0,
          "height": 15.0
        }
      }
    }
  ],
  "dates": [
    {
      "date": "2018-11-21",
      "location": {
        "x": 275.0,
        "y": 511.0,
        "width": 63.0,
        "height": 16.0
      }
    },
    {
      "date": "2018-11-21",
      "location": {
        "x": 275.0,
        "y": 511.0,
        "width": 63.0,
        "height": 16.0
      }
    },
    {
      "date": "2018-11-21",
      "location": {
        "x": 733.0,
        "y": 536.0,
        "width": 60.0,
        "height": 16.0
      }
    },
    {
      "date": "2018-11-21",
      "location": {
        "x": 733.0,
        "y": 536.0,
        "width": 60.0,
        "height": 16.0
      }
    },
    {
      "date": "2018-11-23",
      "location": {
        "x": 733.0,
        "y": 559.0,
        "width": 66.0,
        "height": 15.0
      }
    },
    {
      "date": "2018-11-23",
      "location": {
        "x": 733.0,
        "y": 559.0,
        "width": 66.0,
        "height": 15.0
      }
    },
    {
      "date": "2018-11-21",
      "location": {
        "x": 417.0,
        "y": 606.0,
        "width": 58.0,
        "height": 15.0
      }
    },
    {
      "date": "2018-11-21",
      "location": {
        "x": 417.0,
        "y": 606.0,
        "width": 58.0,
        "height": 15.0
      }
    },
    {
      "date": "2018-11-23",
      "location": {
        "x": 555.0,
        "y": 607.0,
        "width": 63.0,
        "height": 15.0
      }
    },
    {
      "date": "2018-11-23",
      "location": {
        "x": 555.0,
        "y": 607.0,
        "width": 63.0,
        "height": 15.0
      }
    },
    {
      "date": "2018-11-01",
      "location": {
        "x": 57.0,
        "y": 816.0,
        "width": 147.0,
        "height": 18.0
      }
    },
    {
      "date": "2018-11-01",
      "location": {
        "x": 57.0,
        "y": 816.0,
        "width": 147.0,
        "height": 18.0
      }
    },
    {
      "date": "2018-11-21",
      "location": {
        "x": 275.0,
        "y": 511.0,
        "width": 63.0,
        "height": 16.0
      }
    },
    {
      "date": "2018-11-01",
      "location": {
        "x": 57.0,
        "y": 816.0,
        "width": 147.0,
        "height": 18.0
      }
    }
  ],
  "ids": [
    {
      "id": "552072342",
      "location": {
        "x": 275.0,
        "y": 535.0,
        "width": 63.0,
        "height": 15.0
      }
    },
    {
      "id": "552072342",
      "location": {
        "x": 275.0,
        "y": 535.0,
        "width": 63.0,
        "height": 15.0
      }
    }
  ],
  "amounts": [
    {
      "amount": 3.03,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1009.0,
        "width": 24.0,
        "height": 16.0
      }
    },
    {
      "amount": 3.03,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1009.0,
        "width": 24.0,
        "height": 16.0
      }
    },
    {
      "amount": 9.36,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1033.0,
        "width": 24.0,
        "height": 15.0
      }
    },
    {
      "amount": 9.36,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1033.0,
        "width": 24.0,
        "height": 15.0
      }
    },
    {
      "amount": 3.03,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1009.0,
        "width": 24.0,
        "height": 16.0
      }
    },
    {
      "amount": 9.36,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1033.0,
        "width": 24.0,
        "height": 15.0
      }
    },
    {
      "amount": 9.36,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1033.0,
        "width": 24.0,
        "height": 15.0
      }
    },
    {
      "amount": 3.03,
      "currency": "€",
      "location": {
        "x": 689.0,
        "y": 1009.0,
        "width": 24.0,
        "height": 16.0
      }
    }
  ],
  "percentages": [
    {
      "percentage": 19.0,
      "location": {
        "x": 477.0,
        "y": 679.0,
        "width": 34.0,
        "height": 15.0
      }
    },
    {
      "percentage": 19.0,
      "location": {
        "x": 477.0,
        "y": 679.0,
        "width": 34.0,
        "height": 15.0
      }
    },
    {
      "percentage": 7.0,
      "location": {
        "x": 487.0,
        "y": 702.0,
        "width": 27.0,
        "height": 15.0
      }
    },
    {
      "percentage": 7.0,
      "location": {
        "x": 487.0,
        "y": 702.0,
        "width": 27.0,
        "height": 15.0
      }
    },
    {
      "percentage": 19.0,
      "location": {
        "x": 45.0,
        "y": 1007.0,
        "width": 30.0,
        "height": 15.0
      }
    },
    {
      "percentage": 19.0,
      "location": {
        "x": 45.0,
        "y": 1007.0,
        "width": 30.0,
        "height": 15.0
      }
    },
    {
      "percentage": 7.0,
      "location": {
        "x": 44.0,
        "y": 1031.0,
        "width": 26.0,
        "height": 15.0
      }
    },
    {
      "percentage": 7.0,
      "location": {
        "x": 44.0,
        "y": 1031.0,
        "width": 26.0,
        "height": 15.0
      }
    }
  ],
  "types": [
    "hotel",
    "parking",
    "gas",
    "plane",
    "taxi",
    "train",
    "public"
  ],
  "issuers": [
    {
      "issuer": "Motel One Berlin-Alexanderplatz",
      "location": {
        "x": 49.0,
        "y": 202.0,
        "width": 21.0,
        "height": 11.0
      }
    },
    {
      "issuer": "Motel One Berlin-Alexanderplatz",
      "location": {
        "x": 49.0,
        "y": 202.0,
        "width": 21.0,
        "height": 11.0
      }
    }
  ]
};

var __PDF_DOC,
    __CURRENT_PAGE,
    __TOTAL_PAGES,
    __PAGE_RENDERING_IN_PROGRESS = 0;
    //__CANVAS = jQuery('#fileCanvas').get(0),
    //__CANVAS_CTX = __CANVAS.getContext('2d');


var ext = "";
let files = '';
const $ = document.querySelector.bind(document);

var originalImageWidth;
var originalImageHeight;

var scaleHeight = 0;
var scaleWidth = 0;

var width = 0; //final size
var height = 0; //final size
//Prvo mora da se resizeuje slika
//Uzmemo dimenzije slike

//When we click on the type field clear all the canvases because 
//type field has constant options independent of the uploaded file
document.getElementById("typeD").addEventListener("click", function (){
  hideAllCanvas();
  clearHighlights();

  document.getElementById("typeD").value = text.types[1];
});


//Determine the scales
function resizeTheImage(img){
  //Change these vars if you want to allow for bigger pictures
  var MAX_WIDTH = 600;
  var MAX_HEIGHT = 645;

  width = originalImageWidth;
  height = originalImageHeight;
  var scale = 1;

if (width > height) {
  if (width > MAX_WIDTH) {
    height *= MAX_WIDTH / width;
    width = MAX_WIDTH;
    scale = MAX_WIDTH / width;
  }
} else {
  if (height > MAX_HEIGHT) {
    width *= MAX_HEIGHT / height;
    height = MAX_HEIGHT;
    scale = MAX_HEIGHT / height;
  }
}


//Scale the size of the image to the container
scaleHeight = height/originalImageHeight;
scaleWidth = width/originalImageWidth;


//ako je pdf file
if(ext == "pdf"){

alert("hello");
  jQuery('#fileCanvas').show();
  
    pdf_url = URL.createObjectURL(jQuery("#fileInput").get(0).files[0]);
    PDFJS.getDocument({ url: pdf_url }).then(function(pdf_doc) {
      __PDF_DOC = pdf_doc;
      __TOTAL_PAGES = __PDF_DOC.numPages;
      alert("hello");
      // Show the first page
      showPage(1);
    }).catch(function(error) {
      // If error re-show the upload button
      //jQuery("#pdf-loader").hide();
      //jQuery("#upload-button").show();
      
      alert(error.message);
    });;
  
  
  function showPage(page_no) {
    __PAGE_RENDERING_IN_PROGRESS = 1;
    __CURRENT_PAGE = page_no;
    
    // Fetch the page
    __PDF_DOC.getPage(page_no).then(function(page) {
      // As the canvas is of a fixed width we need to set the scale of the viewport accordingly
      
      
      /*
      var scale_required = __CANVAS.width / page.getViewport(1).width;
  
      // Get viewport of the page at required scale
      var viewport = page.getViewport(scale_required); //scale_required
  
      // Set canvas height
      __CANVAS.height = viewport.height;
  
      var renderContext = {
        canvasContext: __CANVAS_CTX,
        viewport: viewport
      };
      
      // Render the page contents in the canvas
      page.render(renderContext).then(function() {
        __PAGE_RENDERING_IN_PROGRESS = 0;
  
        // Re-enable Prev & Next buttons
        //jQuery("#pdf-next, #pdf-prev").removeAttr('disabled');
  
        // Show the canvas and hide the page loader
        jQuery("#fileCanvas").show();
        //jQuery("#page-loader").hide();
        //jQuery("#download-image").show();
      });
      */
  // Set scale (zoom) level
  var scale = scaleHeight;
  
  // Get viewport (dimensions)
  var viewport = page.getViewport(scale);
  
  // Get div#the-svg
  var container = document.getElementById('filePlaceholder');
 
  // Set dimensions
  container.style.width = viewport.width + 'px';
  container.style.height = viewport.height + 'px';
  container.style.backgroundColor = "#ffffff"
  
  // SVG rendering by PDF.js
  page.getOperatorList()
    .then(function (opList) {
    var svgGfx = new PDFJS.SVGGraphics(page.commonObjs, page.objs);
    return svgGfx.getSVG(opList, viewport);
    })
    .then(function (svg) {
      alert("hello");
    container.appendChild(svg);
    });
  
    });
    
  }




}

//showPdf(img.src);

var div = document.createElement("div");
div.id = 'divFile';

//var canvas = document.createElement("canvas");
var canvas = document.getElementById("fileCanvas");
//canvas.id = "fileCanvas";
canvas.width = width;
canvas.height = height;

var ctx = canvas.getContext("2d");
canvas.setAttribute("image-rendering", "pixelated");
ctx.drawImage(img, 0, 0, width, height); //draw the file as canvas
canvas.style.display = "block";

//Insert into the page
div.appendChild(canvas);
document.getElementById("container").appendChild(div);
var container = document.getElementById("container");
container.insertBefore(container.lastChild,container.childNodes[0]);

//Create a transparent image for image map

var map = document.createElement("map");
map.name = "imageMap";
map.id = "map";
container.appendChild(map);


var img = document.createElement("img");
img.src = "transparent.jpg";
img.width = width;
img.height = height;
img.setAttribute("class","map");
img.setAttribute("usemap","#imageMap");
img.usemap = "#imageMap";
container.appendChild(img);

jQuery('.map').maphilight();



//Create a canvas for very field 
function createCanvas(id){
  var canvas = document.createElement("canvas");

  canvas.id = id;
  
  canvas.width = width;
  canvas.height = height;
  canvas.style.display = "none";
  canvas.className = "canvas";
  document.getElementById("container").appendChild(canvas);
  return canvas;
}



//Get input elements for paymentDate
var inputElement = document.getElementById("paymentD");
var canvas = createCanvas("paymentDateCanvas");
var JSONList = text.dates;
var access = "date";
var dropdown = "#paymentDate"
scaleAndDraw(inputElement,canvas,JSONList,dropdown,access);


//Get input elements for invoiceDate
var invoiceDate = document.getElementById("invoiceDateD");
var canvas = createCanvas("invoiceDateCanvas");
var JSONList = text.dates;
var access = "date";
var dropdown = "#invoiceDate"

scaleAndDraw(invoiceDate,canvas,JSONList,dropdown,access);


var invoiceIssuer = document.getElementById("issuerD");
var canvas = createCanvas("issuerCanvas");
var JSONList = text.issuers;
var access = "issuer";
var dropdown = "#issuer";

scaleAndDraw(invoiceIssuer,canvas,JSONList,dropdown,access);


var invoiceNo = document.getElementById("invoiceNoD");
var canvas = createCanvas("noCanvas");
var JSONList = text.ids;
var access = "id";
var dropdown = "#invoiceNo"

scaleAndDraw(invoiceNo,canvas,JSONList,dropdown,access);


var netAmount = document.getElementById("netAmountD");
var canvas = createCanvas("netAmountCanvas");
var JSONList = text.totalAmount;
var access = "netAmount";
var dropdown = "#netAmount"

scaleAndDraw(netAmount,canvas,JSONList,dropdown,access);


var totalAmount = document.getElementById("totalAmountD");
var canvas = createCanvas("totalAmountCanvas");
var JSONList = text.totalAmount;
var access = "totalAmount";
var dropdown = "#totalAmount"

scaleAndDraw(totalAmount,canvas,JSONList,dropdown,access);


var vatAmount = document.getElementById("vatAmountD");
var canvas = createCanvas("vatAmountCanvas");
var JSONList = text.amounts;
var access = "amount";
var dropdown = "#vatAmount"
scaleAndDraw(vatAmount,canvas,JSONList,dropdown,access);


var percAmount = document.getElementById("vatPercD");
var canvas = createCanvas("vatPercCanvas");
var JSONList = text.percentages;
var access = "percentage";
var dropdown = "#vatPerc"

scaleAndDraw(percAmount,canvas,JSONList,dropdown,access);


//For dynamically added vats
jQuery("mainTable").bind("DOMNodeInserted", function(e){
  
  if(e.target && e.target.matches("input.vatInputs")){
  //alert("hola")
    //var vatAmount = document.getElementById("vatAmountD");
canvas = document.getElementById("vatAmountCanvas");
var JSONList = text.amounts;
var access = "amount";
var dropdown = "#vatAmount";

scaleAndDraw(e.target,canvas,JSONList,dropdown,access);

  }
});

} // end of resize image???

//pass the x or width parameters and scale them to the document container
function scaleWidthFunc(widthMeasure){
  return widthMeasure * scaleWidth;
}

//pass the y or height parameters and scale them to the document container
function scaleHeightFunc(heightMeasure){
  return heightMeasure * scaleHeight;
}

//Draw a solid box for the selected value from the drop-down menu
function drawSelected(c,x,y,width,height){
  c.style.display = "block";
  var ctx = c.getContext("2d");
  ctx.globalAlpha = 0.5;
  ctx.beginPath();
  ctx.rect(x, y, width, height);
  ctx.lineWidth = 2;
  ctx.strokeStyle = "#4b9d7e";
  ctx.stroke();

}

//Draw a dotted box for the other possible options for a field 
function drawOtherOptions(c,x,y,width,height){
  c.style.display = "block";
  var ctx = c.getContext("2d");
  ctx.globalAlpha = 0.5;
  ctx.beginPath();
  ctx.setLineDash([2,2]);
  ctx.rect(x, y, width, height);
  ctx.lineWidth = 1;
  ctx.strokeStyle = "#4b9d7e";
  ctx.stroke();
  ctx.setLineDash([0,0]);
}

//Remove everything from the canvas
function clearCanvas(canvas){
  const context = canvas.getContext('2d');
  context.clearRect(0, 0, canvas.width, canvas.height);
}

function hideAllCanvas(){
  var canvasElements = document.getElementsByClassName("canvas");
      for(item of canvasElements){
        item.setAttribute("style", "display:none");
      }
}


function setSelect(inputElement,dropdown){
  //alert("iz set selecta" + dropdown)
  if(! (dropdown instanceof HTMLDataListElement)){
  var dropMenu = document.getElementById(dropdown.substring(1))
  //alert("dropmenu: "+ dropMenu)

    Array.from(dropMenu.options).forEach(function(item) {

      if(item.selected === true){
        //alert("hello");
        //alert(item)
        item.setAttribute("selected",false);
        item.selected = false;
      }
      
      if(item.value === inputElement.value){
        item.setAttribute("selected",true);
        item.selected = true;
      }
        });
  }else{
    //var dropMenu = document.getElementById(dropdown.substring(1));
    Array.from(dropdown.options).forEach(function(item) {

      if(item.selected === true){
        item.selected = false;
      }
      
      if(item.value === inputElement.value){
        item.selected = true;
      }
        });
  }
  
}

//Depending on the type of the field, return the corresponding value primarily selected by the backend
function returnJSONData(access,item){
  if(access === "date"){
    return item.date;
  }

  if(access === "issuer"){
    return item.issuer;
  }
  
  if(access === "id"){
    return item.id;
  }

  if(access === "netAmount"){
    return item.amount;
  }

  if(access === "totalAmount"){
    return item.amount;
  }

  if(access === "amount"){
    return item.amount;
  }

  if(access === "percentage"){
    return item.percentage;
  }

}

function highlightSelectBox(access){

  if(access == "date"){

    document.getElementById("paymentDiv").style.backgroundColor = "rgb(104,177,149,0.5)";
    document.getElementById("dateDiv").style.backgroundColor = "rgb(104,177,149,0.5)";
  }

  if(access === "issuer"){
    document.getElementById("issuerDiv").style.backgroundColor = "rgb(104,177,149,0.5)";
  }
  
  if(access === "id"){
    document.getElementById("invoiceNoDiv").style.backgroundColor = "rgb(104,177,149,0.5)";
  }

  if(access === "netAmount" || access === "totalAmount"){
    document.getElementById("netAmountDiv").style.backgroundColor = "rgb(104,177,149,0.5)";
    document.getElementById("totalAmountDiv").style.backgroundColor = "rgb(104,177,149,0.5)";
  }
/*
  if(access === "totalAmount"){
    document.getElementById("totalAmoundDiv").style.backgroundColor = "#4b9d7e";
  }

  */
  //Mora biti getelementbyclass posto moze biti vise dinamicki dodanih fieldsa
  if(access === "amount"){
    for (item of document.getElementsByClassName("highlightedVATs")){
      item.style.backgroundColor = "rgb(104,177,149,0.5)";
    }
    //document.getElementById("vatAmountDiv").style.backgroundColor = "#4b9d7e";
  }

  if(access === "percentage"){
    for (item of document.getElementsByClassName("highlightedVatPerc")){
      item.style.backgroundColor = "rgb(104,177,149,0.5)";
    }
}
}

function clearHighlights(){

  for(item of document.getElementsByClassName("highlightedDivs")){
    item.style.backgroundColor = "#ffffff";
  }
  for(item of document.getElementsByClassName("highlightedVATs")){
    item.style.backgroundColor = "#ffffff";
  }
  for(item of document.getElementsByClassName("highlightedVatPerc")){
    item.style.backgroundColor = "#ffffff";
  }
}


//on change when the file loads
function handleFileSelect(evt) {

let img1 = new Image();
img1.src = window.webkitURL.createObjectURL(evt.target.files[0]);

img1.style.display="none";
img1.onload = () => {
   originalImageWidth =  img1.width;
   originalImageHeight = img1.height;
   resizeTheImage(img1);
}
files = evt.target.files; 
ext = getExt(files[0].name);
//ako je pdf file
if(ext == "pdf"){

  alert("hello");
    jQuery('#fileCanvas').show();
    
      pdf_url = URL.createObjectURL(jQuery("#fileInput").get(0).files[0]);
      PDFJS.getDocument({ url: pdf_url }).then(function(pdf_doc) {
        __PDF_DOC = pdf_doc;
        __TOTAL_PAGES = __PDF_DOC.numPages;
        alert("hello");
        // Show the first page
        showPage(1);
      }).catch(function(error) {
        // If error re-show the upload button
        //jQuery("#pdf-loader").hide();
        //jQuery("#upload-button").show();
        
        alert(error.message);
      });;
  
  
  }



  files = evt.target.files; 


ext = getExt(files[0].name);
var dot_pos = files[0].name.lastIndexOf(".");
files[0].name = files[0].name.substr(0,dot_pos) + ".png";

    //files template
    let template = `${Object.keys(files).
    map(file => `<div class="file file--${file}">
     <div class="name"><span>${files[file].name}</span></div>
     <div class="progress active"></div>
     <div class="done">
	  <a href="index.html" target="_self">
    <svg class="svg-icon" viewBox="0 0 20 20">
    <path d="M10.185,1.417c-4.741,0-8.583,3.842-8.583,8.583c0,4.74,3.842,8.582,8.583,8.582S18.768,14.74,18.768,10C18.768,5.259,14.926,1.417,10.185,1.417 M10.185,17.68c-4.235,0-7.679-3.445-7.679-7.68c0-4.235,3.444-7.679,7.679-7.679S17.864,5.765,17.864,10C17.864,14.234,14.42,17.68,10.185,17.68 M10.824,10l2.842-2.844c0.178-0.176,0.178-0.46,0-0.637c-0.177-0.178-0.461-0.178-0.637,0l-2.844,2.841L7.341,6.52c-0.176-0.178-0.46-0.178-0.637,0c-0.178,0.176-0.178,0.461,0,0.637L9.546,10l-2.841,2.844c-0.178,0.176-0.178,0.461,0,0.637c0.178,0.178,0.459,0.178,0.637,0l2.844-2.841l2.844,2.841c0.178,0.178,0.459,0.178,0.637,0c0.178-0.176,0.178-0.461,0-0.637L10.824,10z"></path>
  </svg>
						</a>
     </div>
    </div>`).
    join("")}`;

    $("#drop").classList.add("hidden");
    $("footer").classList.add("hasFiles");
    $(".import").classList.add("active");
    //$(".scan").classList.add("active");
    setTimeout(() => {
      $(".list-files").innerHTML = template;
    }, 1000);

    Object.keys(files).forEach(file => {
      let load = 2000 + file * 2000; // fake load
      setTimeout(() => {
        $(`.file--${file}`).querySelector(".progress").classList.remove("active");
        $(`.file--${file}`).querySelector(".done").classList.add("anim");
      }, load);
    });

  }


  jQuery(".area").on("click", function(e){

    //Clear other highlights
    clearHighlights(); 
    //Hide all other canvas
    hideAllCanvas();
    e.preventDefault();
    highlightSelectBox(this.id);
  });

  function showPage(page_no) {
    __PAGE_RENDERING_IN_PROGRESS = 1;
    __CURRENT_PAGE = page_no;
    
    // Fetch the page
    __PDF_DOC.getPage(page_no).then(function(page) {
      // As the canvas is of a fixed width we need to set the scale of the viewport accordingly
      
      
      /*
      var scale_required = __CANVAS.width / page.getViewport(1).width;
  
      // Get viewport of the page at required scale
      var viewport = page.getViewport(scale_required); //scale_required
  
      // Set canvas height
      __CANVAS.height = viewport.height;
  
      var renderContext = {
        canvasContext: __CANVAS_CTX,
        viewport: viewport
      };
      
      // Render the page contents in the canvas
      page.render(renderContext).then(function() {
        __PAGE_RENDERING_IN_PROGRESS = 0;
  
        // Re-enable Prev & Next buttons
        //jQuery("#pdf-next, #pdf-prev").removeAttr('disabled');
  
        // Show the canvas and hide the page loader
        jQuery("#fileCanvas").show();
        //jQuery("#page-loader").hide();
        //jQuery("#download-image").show();
      });
      */
  // Set scale (zoom) level
  var scale = scaleHeight;
  
  // Get viewport (dimensions)
  var viewport = page.getViewport(scale);
  
  // Get div#the-svg
  var container = document.getElementById('filePlaceholder');
  alert("hello");
  // Set dimensions
  container.style.width = viewport.width + 'px';
  container.style.height = viewport.height + 'px';
  container.style.backgroundColor = "#ffffff"
  
  // SVG rendering by PDF.js
  page.getOperatorList()
    .then(function (opList) {
    var svgGfx = new PDFJS.SVGGraphics(page.commonObjs, page.objs);
    return svgGfx.getSVG(opList, viewport);
    })
    .then(function (svg) {
    container.appendChild(svg);
    });
  
    });
    
  }



  

  function scaleAndDraw(inputElement,canvas,JSONList,dropdown,access){ 


    //Make the clickable map
    if(Symbol.iterator in Object(JSONList)){ //iterable?yes:no
      for(item of JSONList){

        //Depending on the type of the field, access the particular field from the JSON
        var d = returnJSONData(access,item);

        var x = scaleWidthFunc(item.location.x);
        var width = scaleWidthFunc(item.location.width);
    
        var y = scaleHeightFunc(item.location.y);
        var height = scaleHeightFunc(item.location.height);

//create new area for every single one of these rectangles
var area = document.createElement("area");

area.shape = "rect";
area.id = access;
newWidth = width + x;
newHeight = height+y;
area.coords = x +","+y+","+newWidth+","+newHeight;
area.href = "#";
area.setAttribute("class","area");
area.setAttribute('data-maphilight','{\"strokeColor\":\"4b9d7e\",\"strokeWidth\":1,\"fillColor\":\"c2ecdc\",\"fillOpacity\":0.3}');


//area.onclick= highlightSelectBox(access);

jQuery(".area").on("click", function(e){

  //Clear other highlights
  clearHighlights(); 
  //Hide all other canvas
  hideAllCanvas();
  e.preventDefault();
  highlightSelectBox(this.id);
});

document.getElementById("map").appendChild(area);

var selected = jQuery(dropdown).find(":selected").text();
if(d == selected){
    var coordinates = new Array();
    coordinates.push(x,y,width,height);
    selectedValueMapping.set(selected,coordinates);
    //alert(selectedValueMapping.get(selected));
}
      }}
      //ako postoji samo jedna jedina opcija
      else{

 //Depending on the type of the field, access the particular field from the JSON
 var d = returnJSONData(access,JSONList);

 var x = scaleWidthFunc(JSONList.location.x);
 var width = scaleWidthFunc(JSONList.location.width);

 var y = scaleHeightFunc(JSONList.location.y);
 var height = scaleHeightFunc(JSONList.location.height);

//create new area for every single one of these rectangles
var area = document.createElement("area");
area.shape = "rect";
area.id = access;
newWidth = width + x;
newHeight = height+y;
area.coords = x +","+y+","+newWidth+","+newHeight;
area.href = "";
area.setAttribute("class","area");
area.setAttribute('data-maphilight','{\"strokeColor\":\"4b9d7e\",\"strokeWidth\":1,\"fillColor\":\"c2ecdc\",\"fillOpacity\":0.3}');
//area.onclick= highlightSelectBox(access);

jQuery(".area").on("click", function(e){

//Clear other highlights
clearHighlights(); 
//Hide all other canvas
hideAllCanvas();
e.preventDefault();
highlightSelectBox(this.id);
});

document.getElementById("map").appendChild(area);

var selected = jQuery(dropdown).find(":selected").text();
if(d == selected){
var coordinates = new Array();
coordinates.push(x,y,width,height);
selectedValueMapping.set(selected,coordinates);
//alert(selectedValueMapping.get(selected));
}

      } //end of else(iterable?)
   
    inputElement.addEventListener("click",function(){
      //Clear possible highlights
      clearHighlights(); 

      //Hide all other canvas
      hideAllCanvas();

      //Clear canvas every time a new value is selected
      clearCanvas(canvas);

      //Get selected value from the drop-down
      var selected = jQuery(dropdown).find(":selected").text();

      var d ="";
      
      if(Symbol.iterator in Object(JSONList)){ //iterable?yes:no
      for(item of JSONList){

        //Depending on the type of the field, return the corresponding value primarily selected by the backend
        var d = returnJSONData(access,item);

        var x = scaleWidthFunc(item.location.x);
        var width = scaleWidthFunc(item.location.width);
    
        var y = scaleHeightFunc(item.location.y);
        var height = scaleHeightFunc(item.location.height);
        
      
        if(d == selected){
          /*
          var coordinates = new Array();
          coordinates.push(x,y,width,height);
          selectedValueMapping.set(selected,coordinates);
          */
          drawSelected(canvas,x,y,width,height); //solid line
        }else{
          drawOtherOptions(canvas,x,y,width,height); //dashed line
    }

       
    

  }
      }else{
        
         //Depending on the type of the field, return the corresponding value primarily selected by the backend
         var d = returnJSONData(access,JSONList);
         var x = scaleWidthFunc(JSONList.location.x);
         var width = scaleWidthFunc(JSONList.location.width);
     
         var y = scaleHeightFunc(JSONList.location.y);
         var height = scaleHeightFunc(JSONList.location.height);
       
         //alert(selected1);
         //alert(selected);
        
         if(d == selected){
           /*
          var coordinates = new Array();
          coordinates.push(x,y,width,height);
          selectedValueMapping.set(selected,coordinates);
          */
           drawSelected(canvas,x,y,width,height);
         }else{
           drawOtherOptions(canvas,x,y,width,height);
      
     }


      }


    });
      


//Kad se selectuje onda treba da se promijeni i solid line koja prikazuje canvas

inputElement.addEventListener("change",function(){

  
  //Change the selected attribute as the user selects different options
  setSelect(inputElement,dropdown);
  
  //Clear canvas every time a new value is selected  
  clearCanvas(canvas);

  //Get new selected value
  var selected1 = jQuery(dropdown).find(":selected").text();

  //alert(" selected1: " + selected1);
  if(Symbol.iterator in Object(JSONList)){
  for(item of JSONList){


    //Depending on the type of the field, return the corresponding value primarily selected by the backend
    var d = returnJSONData(access,item);
    
    var x = scaleWidthFunc(item.location.x);
    var width = scaleWidthFunc(item.location.width);

    var y = scaleHeightFunc(item.location.y);
    var height = scaleHeightFunc(item.location.height);
   
  
    if(d == selected1){
        //alert(d);
      var coordinates = new Array();
          coordinates.push(x,y,width,height);
          selectedValueMapping.set(selected1,coordinates);
          drawSelected(canvas,x,y,width,height);
      //alert("hello")
    }
    else{
      drawOtherOptions(canvas,x,y,width,height);
    }

  }

  }else{
        
    //Depending on the type of the field, return the corresponding value primarily selected by the backend
    var d = returnJSONData(access,JSONList);
    var x = scaleWidthFunc(JSONList.location.x);
    var width = scaleWidthFunc(JSONList.location.width);

    var y = scaleHeightFunc(JSONList.location.y);
    var height = scaleHeightFunc(JSONList.location.height);
  
    //alert(selected1);
    //alert(selected);
   
    if(d == selected1){
      var coordinates = new Array();
          coordinates.push(x,y,width,height);
          selectedValueMapping.set(selected1,coordinates);
      drawSelected(canvas,x,y,width,height);
    }else{
      drawOtherOptions(canvas,x,y,width,height);
 
}

 }
  
});

 } //end of scaleAndDraw





  // trigger input
  $("#triggerFile").addEventListener("click", evt => {
    evt.preventDefault();
    $("input[type=file]").click();
  });

  // drop events
  $("#drop").ondragleave = evt => {
    $("#drop").classList.remove("active");
    evt.preventDefault();
  };
  $("#drop").ondragover = $("#drop").ondragenter = evt => {
    $("#drop").classList.add("active");
    evt.preventDefault();
  };
  $("#drop").ondrop = evt => {
    $("input[type=file]").files = evt.dataTransfer.files;
    $("footer").classList.add("hasFiles");
    $("#drop").classList.remove("active");
    evt.preventDefault();
  };

  //upload more
  $(".import").addEventListener("click", () => {

    $(".upload").style.display = 'none';
    $("#Page2").style.display = 'block';
   
  });

  $("#submit").addEventListener("click", () => {

    hideAllCanvas();
    $("#form").style.display = 'none';
    $(".map").style.display = 'none';
    $("#Page3").style.display = 'block';
   
  
  

var canvas = createCanvas("summaryCanvas");

canvas.style.display = 'block';
var collection = document.getElementsByClassName("inputs");

for(var i =0; i<collection.length; i++){

  if(selectedValueMapping.has(collection.item(i).value)){
    var x = selectedValueMapping.get(collection.item(i).value)[0];
    var y = selectedValueMapping.get(collection.item(i).value)[1];
    var width = selectedValueMapping.get(collection.item(i).value)[2];
    var height = selectedValueMapping.get(collection.item(i).value)[3];
  
    drawSelected(canvas,x,y,width,height);
  }
}
document.getElementById("container").appendChild(canvas);

  
  });

  // input change
  $("input[type=file]").addEventListener("change", handleFileSelect);
  
//}();


var embed = document.getElementById('Page2');
// Wait for the document to load inside embed element



function getExt(filename) {
  var dot_pos = filename.lastIndexOf(".");
  if (dot_pos == -1) {
      return "";
  }
  return filename.substr(dot_pos + 1).toLowerCase();
}


var closebtns = document.getElementsByClassName("close");
var i;

/* Loop through the elements, and hide the parent, when clicked on */
for (i = 0; i < closebtns.length; i++) {

  closebtns[i].addEventListener("click", function() {
    
    var table = document.getElementById("dataSummary");
    
    //Ukloni sve sto nije default 
    var length = table.rows.length;
    for(var j= length-1; j>=9; j--){
      table.deleteRow(j);
    }

    for (var i = 0, row; row = table.rows[i]; i++) {
      var cell = row.cells[1];
      cell.innerHTML="";
    }

    hideAllCanvas();
    $("#Page3").style.display = 'none';
    //$("#Page2").style.display = 'block';
    $("#form").style.display = 'block';
    $(".map").style.display ='block';
    clearCanvas(document.getElementById("summaryCanvas"));
    document.getElementById("summaryCanvas").style.display = 'none';
    document.querySelector("#container > div.map > img").style.display = 'block';
    
});
}


$(".close").addEventListener("click", evt => {
  evt.preventDefault();
  $("#Page1").style.display = 'block';

  //document.getElementById("Page2").setAttribute("style","display:none");
  $("#Page2").style.display = 'none';
});

  function returnToMain(){
      $("#Page1").style.display = 'block';

      //document.getElementById("Page2").setAttribute("style","display:none");
      $("#Page2").style.display = 'none';
     
     
  }
paymentDate.addEventListener("mouseout",function(){
  document.getElementById("myCanvas").setAttribute("style", "display:none");

});

//Used to save values in the drop down menu


var oldValue = '';

jQuery('input').on('click', function() {
  oldValue = jQuery(this).val();
  jQuery(this).val('');
});

// Restore current value after click
jQuery('input').on('mouseleave', function() {
  if (jQuery(this).val() == '') {
    jQuery(this).val(oldValue);
  }
});


var datesList = new Set();
var invoiceIssuers = new Set();
var invoiceDates = new Set();
var uniqueVATAmounts = new Set();
var selectedValueMapping = new Map();

function createCanvas(id){
  var canvas = document.createElement("canvas");

  canvas.id = id;
  
  canvas.width = width;
  canvas.height = height;
  canvas.style.display = "none";
  canvas.className = "canvas";
  document.getElementById("container").appendChild(canvas);
  return canvas;
}

  loadPaymentDate();
  loadInvoiceIssuer();
  loadInvoiceTypes(); 
  loadInvoiceDate();
  loadInvoiceNo();
  loadVATAmounts();
  loadVATPercentage(); 
  loadNetAmount();
  loadTotalAmount();
  
  
  
  
  
  function loadPaymentDate(){
    
      for (var instance of text['dates']) {
        if(!(datesList.has(instance.date))){
          datesList.add(instance.date);
          var x = document.getElementById("paymentDate");
          var option = document.createElement("option");
          option.text = instance.date;
          option.value = instance.date;
          document.getElementById("paymentDate").appendChild(option);
  /*
          var x = document.getElementById("paymentDate");
          var option = document.createElement("option");
          option.text = instance.date;
          x.add(option, x[0]);
  */
          //$('<option>' + instance.date + '</option>').appendTo('#paymentDate');
        }
      }
  /*
      var paymentObject = document.getElementById("paymentDate");
      var payment = text['paymentDate'].date;
      paymentObject.value = payment;
      */
     //jQuery("#paymentDate option[value='"+text['paymentDate'].date+"' ]").attr("selected", true);
  
     document.querySelector("#paymentDate option[value='"+text['paymentDate'].date+"' ]").setAttribute('selected',true);
    document.getElementById("paymentD").value = text['paymentDate'].date;
  }
  

  function loadInvoiceIssuer(){
    for (var instance of text['issuers']) {
      if(!(invoiceIssuers.has(instance.issuer))){
        invoiceIssuers.add(instance.issuer);
        //$('<option>' + instance.issuer + '</option>').appendTo('#issuer');
          var x = document.getElementById("issuer");
          var option = document.createElement("option");
          option.text = instance.issuer;
          option.value = instance.issuer;
          document.getElementById("issuer").appendChild(option);
  
          //x.add(option, x[0]);
      }
    }
  /*
      var element = document.getElementById("issuer");
      element.value = text['invoiceIssuer'].issuer;
      */
     document.querySelector("#issuer option[value='"+text['invoiceIssuer'].issuer+"' ]").setAttribute('selected',true);
     document.getElementById("issuerD").value = text['invoiceIssuer'].issuer;
  }
  
  
  function loadInvoiceTypes(){
      var map = new Map();
      for(var item of text['types']){
          if(item in map){
              continue;
          }else{
              map[item]=1;
              //$('<option>' + item + '</option>').appendTo('#type');
  
              var x = document.getElementById("type");
              var option = document.createElement("option");
              option.text = item;
              option.value = item;
              //x.add(option, x[0]);
              document.getElementById("type").appendChild(option);
              }
          }
          /*
      var invoiceType = document.getElementById("type");
      invoiceType.value = text['invoiceType'];
  */
  
  document.getElementById("typeD").value = text['invoiceType'];
  }
  

  function loadInvoiceDate(){
    for (var instance of text['dates']) {
      if(!(invoiceDates.has(instance.date))){
        invoiceDates.add(instance.date);
        //$('<option>' + instance.date + '</option>').appendTo('#invoiceDate');
  
          var x = document.getElementById("invoiceDate");
          var option = document.createElement("option");
          option.text = instance.date;
          option.value = instance.date;
          document.getElementById("invoiceDate").appendChild(option);
          //x.add(option, x[0]);
      }
    }
    document.querySelector("#invoiceDate option[value='"+text['invoiceDate'].date+"' ]").setAttribute('selected',true);
     document.getElementById("invoiceDateD").value = text['invoiceDate'].date; 
  }
  
  function loadInvoiceNo(){
      var map ={};
      for(var item of text['ids']){
          if(!(item.id in map)){
              map[item.id]=1;
              //$('<option>' + item.id + '</option>').appendTo('#invoiceNo');
              var x = document.getElementById("invoiceNo");
              var option = document.createElement("option");
              option.text = item.id;
              option.value = item.id;
              document.getElementById("invoiceNo").appendChild(option);
              //x.add(option, x[0]);
              }
  
          }
         
  
  document.querySelector("#invoiceNo option[value='"+text['invoiceId'].id+"' ]").setAttribute('selected',true);
  
  document.getElementById("invoiceNoD").value = text['invoiceId'].id;
  }
  

  
  function getUniqueVATAmounts(){
    for (var instance of text['amounts']) {
      if(!(uniqueVATAmounts.has(instance.amount))){
        uniqueVATAmounts.add(instance.amount);
      }
    }
  }
  
  function loadVATAmounts(){
    getUniqueVATAmounts();
    var setIter = uniqueVATAmounts.values();
    var count = 0;
    for(var i =0; i<uniqueVATAmounts.size; i++){
        var x = document.getElementsByClassName("vatAmountPre");
        var option = document.createElement("option");
        option.text = setIter.next().value;
        option.value = option.text;
        $('.vatAmountPre').appendChild(option);
        //$('.vatAmountPre').add(option);
       
    }
    /*
    var vatAmount = document.getElementsByClassName("vatAmountPre");
    vatAmount.value = text['vatAmounts'][0].amount;
  */
  document.querySelector("#vatAmount option[value='"+text['vatAmounts'][0].amount.amount+"' ]").setAttribute('selected',true);
  document.getElementById("vatAmountD").value = text['vatAmounts'][0].amount.amount;
  }
  
  
  function loadVATPercentage(){
    
    var map = {};
      for(var item of text['percentages']){
          if(!(item.percentage in map)){
              map[item.percentage]=1;
              //$('<option>' + item.percentage + '</option>').appendTo(document.getElementsByClassName("vatPerc"));
              var option = document.createElement("option");
              option.text = item.percentage;
              option.value = item.percentage;
              $('.vatPercPre').appendChild(option);
              }
  
          }
  /*
    var vatPerc = document.getElementsByClassName("vatPercPre");
    vatPerc.value = text['vatAmounts'][0].percentage;
          */
         document.querySelector("#vatPerc option[value='"+text['vatAmounts'][0].percentage.percentage+"' ]").setAttribute('selected',true);
         document.getElementById("vatPercD").value = text['vatAmounts'][0].percentage.percentage;
  }
  
  function loadNetAmount(){
    var setIter = uniqueVATAmounts.values();
    for(var i =0; i<uniqueVATAmounts.size; i++){
      //$('<option>' + setIter.next().value + '</option>').appendTo(document.getElementById("netAmount"));
      var x = document.getElementById("netAmount");
          var option = document.createElement("option");
          option.text = setIter.next().value;
          option.value = option.text;
          document.getElementById("netAmount").appendChild(option);
          //x.add(option, x[0]);
    }
  
    //$('<option>' + text['totalAmount'].amount + '</option>').appendTo('#netAmount');
    var x = document.getElementById("netAmount");
    var option = document.createElement("option");
    option.text = text['totalAmount'].amount;
    option.value = text['totalAmount'].amount;
    document.getElementById("netAmount").appendChild(option);
    //x.add(option, x[0]);
    
    document.querySelector("#netAmount option[value='"+text['totalAmount'].amount+"' ]").setAttribute('selected',true);
    document.getElementById("netAmountD").value = text['totalAmount'].amount;
    
  }
  
  function loadTotalAmount(){
    //$('<option>' + text['totalAmount'].amount + '</option>').appendTo('#totalAmount');
    var x = document.getElementById("totalAmount");
    var option = document.createElement("option");
    option.text = text['totalAmount'].amount;
    option.value = text['totalAmount'].amount;
    document.getElementById("totalAmount").appendChild(option);
  
    document.getElementById("totalAmountD").value = text['totalAmount'].amount;
    document.querySelector("#totalAmount option[value='"+text['totalAmount'].amount+"' ]").setAttribute('selected',true);
  };
  
  
  document.querySelector('body').addEventListener("click", function(event){
  
    //Dodaje se novi vat
    if (event.target.value === 'add') {
      var row = event.target.parentElement.parentElement.parentElement.rowIndex;
    
      var table = document.getElementById("mainTable");

       
          var vatAmount = document.getElementById("vatAmountPre");
          var vatPerc = document.getElementById("vatPercPre");
          
          var amountClone = vatAmount.cloneNode(true);
          
          var inputElement = amountClone.childNodes[5].childNodes[1];
          var dropdown = amountClone.childNodes[5].childNodes[3];
        
          //alert(inputElement);
          //var vatAmount = document.getElementById("vatAmountD");
        var canvas = createCanvas("vatAmountCanvas");
        var JSONList = text.amounts;
        var access = "amount";
        //var dropdown = "#vatAmount";
scaleAndDraw(inputElement,canvas,JSONList,dropdown,access);


          //jos jedan event listener za vat perc
          var percClone = vatPerc.cloneNode(true);
        
          var inputElement = percClone.childNodes[1].childNodes[5].childNodes[1];
          var dropdown = percClone.childNodes[1].childNodes[5].childNodes[3];
          
          //var percAmount = document.getElementById("vatPercD");
          var canvas = createCanvas("vatPercCanvas");
          var JSONList = text.percentages;
          var access = "percentage";
          //var dropdown = "#vatPerc";

          scaleAndDraw(inputElement,canvas,JSONList,dropdown,access);
         


          var middleRow = table.insertRow(row);
    
          middleRow.appendChild(amountClone);
          middleRow.appendChild(percClone);
    
          document.getElementsByClassName("deleteButton").disabled = false;
          }
          displayDropdownOptions();
    
  });

  //Delete row for vats
  document.querySelector('body').addEventListener("click", function(event){
    if (event.target.value === 'delete') {
      var rowCount = event.target.parentElement.parentElement.parentElement.rowIndex;
      var table = document.getElementById("mainTable");
      if(table.rows.length <=7){
        document.getElementsByClassName("deleteButton").disabled = true;
        document.getElementsByClassName("addButton").disabled = false;
    }else{
        var tr = table.deleteRow(rowCount);
        document.getElementsByClassName("addButton").disabled = false;
    }

    }
  });

  /*
      function deleteRow(){
      
          var table = document.getElementById("mainTable");
          var rowCount = table.rows.length - 4;
          if(table.rows.length <=7){
              document.getElementsByClassName("deleteButton").disabled = true;
              document.getElementsByClassName("addButton").disabled = false;
          }else{
              var tr = table.deleteRow(rowCount);
              document.getElementsByClassName("addButton").disabled = false;
          }
  
      }
      */
  
      function goToConfirmPage(){
        var paymentDate = document.getElementById("paymentD").value;
        var invoiceIssuer = document.getElementById("issuerD").value;
        var invoiceType = document.getElementById("typeD").value;
        var invoiceDate = document.getElementById("invoiceDateD").value;
        var invoiceNo = document.getElementById("invoiceNoD").value;
        var netAmount = document.getElementById("netAmountD").value;
        var totalAmount = document.getElementById("totalAmountD").value;
  
        var countOfVAT = document.getElementsByClassName("vatAmountPre").length;
        var vatAmount = new Map();
  
        /*
        var amounts = document.getElementsByClassName("vatAmountPre");
        var percentages = document.getElementsByClassName("vatPercPre");
  */
        var amounts = document.getElementsByName("vatAmountD");
        var percentages = document.getElementsByName("vatPercD");
  
        var counter = 1;
  
        for(var i = 1; i<countOfVAT; i++){
          /*
          var selectedAmount = amounts.item(counter).selectedIndex;
          var selectedPerc =  percentages.item(counter).selectedIndex;
  
          var text = amounts.item(counter).options[selectedAmount].text;
          var text1 = percentages.item(counter).options[selectedPerc].text;
          */
  
         var text = amounts.item(counter).value;
         var text1 = percentages.item(counter).value;
          counter++;
  
          var table = document.getElementById("dataSummary");
  
  
          var row = table.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          cell1.innerHTML = "VAT Percentage";
          cell2.innerHTML = text1 + "%" ;
  
          var row2 = table.insertRow();
          var cell3 = row2.insertCell(0);
          var cell4 = row2.insertCell(1);
          cell3.innerHTML = "VAT Amount";
          cell4.innerHTML = text;
  
  
  
  
        
        }
  
      /*
        var VATs  = $('#vatAmount').options[$('#vatAmount').selectedIndex].text;
        var VATsPerc  = $('#vatPerc').options[$('#vatPerc').selectedIndex].text;
        */
  
        var VATs = $('#vatAmountD').value;
        var VATsPerc = $('#vatPercD').value;
        vatAmount[VATs] = VATsPerc;
  
  
        var dataArray = new Array();
        dataArray.push(paymentDate,invoiceIssuer,invoiceType,invoiceDate,invoiceNo,vatAmount,netAmount,totalAmount);
  
  
  document.getElementById('paymentDateExp').innerHTML = document.getElementById('invoiceNoExp').innerHTML +dataArray[0];
  document.getElementById('invoiceIssuerExp').innerHTML = document.getElementById('invoiceIssuerExp').innerHTML +dataArray[1];
  document.getElementById('invoiceTypeExp').innerHTML = document.getElementById('invoiceTypeExp').innerHTML +dataArray[2];
  document.getElementById('invoiceDateExp').innerHTML = document.getElementById('invoiceDateExp').innerHTML +dataArray[3];
  document.getElementById('invoiceNoExp').innerHTML = document.getElementById('invoiceNoExp').innerHTML +dataArray[4];
  document.getElementById('vatAmountExp').innerHTML = document.getElementById('vatAmountExp').innerHTML + Object.keys(dataArray[5]);
  document.getElementById('vatPercExp').innerHTML = document.getElementById('vatPercExp').innerHTML + dataArray[5][VATs] + '%';
  document.getElementById('netAmountExp').innerHTML = document.getElementById('netAmountExp').innerHTML +dataArray[6];
  document.getElementById('totalAmountExp').innerHTML = document.getElementById('totalAmountExp').innerHTML +dataArray[7];
      }
  
  
      function exportData(){
        $("#Page2").style.display = 'none';
        $("#Page3").style.display = 'block';
      }
  
  //Used to display all values form the drop down menu at any point
  function displayDropdownOptions(){
    var oldValue = '';
  
    
  jQuery('input').on('click', function() {
    oldValue = jQuery(this).val();
    jQuery(this).val('');
  });
  
  // Restore current value after click
  jQuery('input').on('mouseleave', function() {
    if (jQuery(this).val() == '') {
      jQuery(this).val(oldValue);
    }
  });
  }


  function clearAllCanvas(){
    var canvasElements = document.getElementsByClassName("canvas");
    for(item of canvasElements){
      const context = item.getContext('2d');
      context.clearRect(0, 0, item.width, item.height);
    }
  }
 //draw(inputElement,canvas,JSONList,dropdown,access);
  function draw(canvas,JSONList,dropdown,access){
          //Clear possible highlights
          clearHighlights(); 

          //Hide all other canvas
          //hideAllCanvas();

          //Clear canvas every time a new value is selected
          clearCanvas(canvas);
    
          //Get selected value from the drop-down
          var selected = jQuery(dropdown).find(":selected").text();
    
          var d ="";
          
          if(Symbol.iterator in Object(JSONList)){ //iterable?yes:no
          for(item of JSONList){
    
            //Depending on the type of the field, return the corresponding value primarily selected by the backend
            var d = returnJSONData(access,item);
    
            var x = scaleWidthFunc(item.location.x);
            var width = scaleWidthFunc(item.location.width);
        
            var y = scaleHeightFunc(item.location.y);
            var height = scaleHeightFunc(item.location.height);
            
          
              drawOtherOptions(canvas,x,y,width,height); //dashed line

    
           
        
    
      }
          }else{
            
             //Depending on the type of the field, return the corresponding value primarily selected by the backend
             var d = returnJSONData(access,JSONList);
             var x = scaleWidthFunc(JSONList.location.x);
             var width = scaleWidthFunc(JSONList.location.width);
         
             var y = scaleHeightFunc(JSONList.location.y);
             var height = scaleHeightFunc(JSONList.location.height);
           
             //alert(selected1);
             //alert(selected);
            
   
               /*
              var coordinates = new Array();
              coordinates.push(x,y,width,height);
              selectedValueMapping.set(selected,coordinates);
              */
    
               drawOtherOptions(canvas,x,y,width,height);
          
             
    
    
          }
  }
  

  function showAll(){

    clearAllCanvas();
//Get input elements for paymentDate

var canvas = document.getElementById("paymentDateCanvas");
var JSONList = text.dates;
var access = "date";
var dropdown = "#paymentDate"
draw(canvas,JSONList,dropdown,access);

//Get input elements for invoiceDate

var canvas = document.getElementById("invoiceDateCanvas");
var JSONList = text.dates;
var access = "date";
var dropdown = "#invoiceDate"

draw(canvas,JSONList,dropdown,access);


var canvas = document.getElementById("issuerCanvas");
var JSONList = text.issuers;
var access = "issuer";
var dropdown = "#issuer";

draw(canvas,JSONList,dropdown,access);


var canvas = document.getElementById("noCanvas");
var JSONList = text.ids;
var access = "id";
var dropdown = "#invoiceNo"

draw(canvas,JSONList,dropdown,access);


var canvas = document.getElementById("netAmountCanvas");
var JSONList = text.totalAmount;
var access = "netAmount";
var dropdown = "#netAmount"

draw(canvas,JSONList,dropdown,access);


var canvas = document.getElementById("totalAmountCanvas");
var JSONList = text.totalAmount;
var access = "totalAmount";
var dropdown = "#totalAmount"

draw(canvas,JSONList,dropdown,access);




var canvas = document.getElementById("vatAmountCanvas");
var JSONList = text.amounts;
var access = "amount";
var dropdown = "#vatAmount"

draw(canvas,JSONList,dropdown,access);


var canvas = document.getElementById("vatPercCanvas");
var JSONList = text.percentages;
var access = "percentage";
var dropdown = "#vatPerc"
draw(canvas,JSONList,dropdown,access);


    
    var canvasElements = document.getElementsByClassName("canvas");
    for(item of canvasElements){
      item.setAttribute("style", "display:block");
    }
  }
  

    