var datesList = new Set();
var text = {
    "status": "success",
    "invoiceType": "hotel",
    "invoiceIssuer": {
      "issuer": "Motel One Berlin-Alexanderplatz",
      "location": {
        "x": 49.0,
        "y": 202.0,
        "width": 21.0,
        "height": 11.0
      }
    },
    "invoiceDate": {
      "date": "2018-11-21",
      "location": {
        "x": 275.0,
        "y": 511.0,
        "width": 63.0,
        "height": 16.0
      }
    },
    "paymentDate": {
      "date": "2018-11-01",
      "location": {
        "x": 57.0,
        "y": 816.0,
        "width": 147.0,
        "height": 18.0
      }
    },
    "invoiceId": {
      "id": "552072342",
      "location": {
        "x": 275.0,
        "y": 535.0,
        "width": 63.0,
        "height": 15.0
      }
    },
    "totalAmount": {
      "amount": 162.0,
      "currency": "€",
      "location": {
        "x": 716.0,
        "y": 731.0,
        "width": 29.0,
        "height": 16.0
      }
    },
    "vatAmounts": [
      {
        "amount": {
          "amount": 3.03,
          "currency": "€",
          "location": {
            "x": 689.0,
            "y": 1009.0,
            "width": 24.0,
            "height": 16.0
          }
        },
        "percentage": {
          "percentage": 19.0,
          "location": {
            "x": 477.0,
            "y": 679.0,
            "width": 34.0,
            "height": 15.0
          }
        }
      },
      {
        "amount": {
          "amount": 9.36,
          "currency": "€",
          "location": {
            "x": 689.0,
            "y": 1033.0,
            "width": 24.0,
            "height": 15.0
          }
        },
        "percentage": {
          "percentage": 7.0,
          "location": {
            "x": 487.0,
            "y": 702.0,
            "width": 27.0,
            "height": 15.0
          }
        }
      },
      {
        "amount": {
          "amount": 9.36,
          "currency": "€",
          "location": {
            "x": 689.0,
            "y": 1033.0,
            "width": 24.0,
            "height": 15.0
          }
        },
        "percentage": {
          "percentage": 7.0,
          "location": {
            "x": 487.0,
            "y": 702.0,
            "width": 27.0,
            "height": 15.0
          }
        }
      },
      {
        "amount": {
          "amount": 3.03,
          "currency": "€",
          "location": {
            "x": 689.0,
            "y": 1009.0,
            "width": 24.0,
            "height": 16.0
          }
        },
        "percentage": {
          "percentage": 19.0,
          "location": {
            "x": 477.0,
            "y": 679.0,
            "width": 34.0,
            "height": 15.0
          }
        }
      }
    ],
    "dates": [
      {
        "date": "2018-11-21",
        "location": {
          "x": 275.0,
          "y": 511.0,
          "width": 63.0,
          "height": 16.0
        }
      },
      {
        "date": "2018-11-21",
        "location": {
          "x": 275.0,
          "y": 511.0,
          "width": 63.0,
          "height": 16.0
        }
      },
      {
        "date": "2018-11-21",
        "location": {
          "x": 733.0,
          "y": 536.0,
          "width": 60.0,
          "height": 16.0
        }
      },
      {
        "date": "2018-11-21",
        "location": {
          "x": 733.0,
          "y": 536.0,
          "width": 60.0,
          "height": 16.0
        }
      },
      {
        "date": "2018-11-23",
        "location": {
          "x": 733.0,
          "y": 559.0,
          "width": 66.0,
          "height": 15.0
        }
      },
      {
        "date": "2018-11-23",
        "location": {
          "x": 733.0,
          "y": 559.0,
          "width": 66.0,
          "height": 15.0
        }
      },
      {
        "date": "2018-11-21",
        "location": {
          "x": 417.0,
          "y": 606.0,
          "width": 58.0,
          "height": 15.0
        }
      },
      {
        "date": "2018-11-21",
        "location": {
          "x": 417.0,
          "y": 606.0,
          "width": 58.0,
          "height": 15.0
        }
      },
      {
        "date": "2018-11-23",
        "location": {
          "x": 555.0,
          "y": 607.0,
          "width": 63.0,
          "height": 15.0
        }
      },
      {
        "date": "2018-11-23",
        "location": {
          "x": 555.0,
          "y": 607.0,
          "width": 63.0,
          "height": 15.0
        }
      },
      {
        "date": "2018-11-01",
        "location": {
          "x": 57.0,
          "y": 816.0,
          "width": 147.0,
          "height": 18.0
        }
      },
      {
        "date": "2018-11-01",
        "location": {
          "x": 57.0,
          "y": 816.0,
          "width": 147.0,
          "height": 18.0
        }
      },
      {
        "date": "2018-11-21",
        "location": {
          "x": 275.0,
          "y": 511.0,
          "width": 63.0,
          "height": 16.0
        }
      },
      {
        "date": "2018-11-01",
        "location": {
          "x": 57.0,
          "y": 816.0,
          "width": 147.0,
          "height": 18.0
        }
      }
    ],
    "ids": [
      {
        "id": "552072342",
        "location": {
          "x": 275.0,
          "y": 535.0,
          "width": 63.0,
          "height": 15.0
        }
      },
      {
        "id": "552072342",
        "location": {
          "x": 275.0,
          "y": 535.0,
          "width": 63.0,
          "height": 15.0
        }
      }
    ],
    "amounts": [
      {
        "amount": 3.03,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1009.0,
          "width": 24.0,
          "height": 16.0
        }
      },
      {
        "amount": 3.03,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1009.0,
          "width": 24.0,
          "height": 16.0
        }
      },
      {
        "amount": 9.36,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1033.0,
          "width": 24.0,
          "height": 15.0
        }
      },
      {
        "amount": 9.36,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1033.0,
          "width": 24.0,
          "height": 15.0
        }
      },
      {
        "amount": 3.03,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1009.0,
          "width": 24.0,
          "height": 16.0
        }
      },
      {
        "amount": 9.36,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1033.0,
          "width": 24.0,
          "height": 15.0
        }
      },
      {
        "amount": 9.36,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1033.0,
          "width": 24.0,
          "height": 15.0
        }
      },
      {
        "amount": 3.03,
        "currency": "€",
        "location": {
          "x": 689.0,
          "y": 1009.0,
          "width": 24.0,
          "height": 16.0
        }
      }
    ],
    "percentages": [
      {
        "percentage": 19.0,
        "location": {
          "x": 477.0,
          "y": 679.0,
          "width": 34.0,
          "height": 15.0
        }
      },
      {
        "percentage": 19.0,
        "location": {
          "x": 477.0,
          "y": 679.0,
          "width": 34.0,
          "height": 15.0
        }
      },
      {
        "percentage": 7.0,
        "location": {
          "x": 487.0,
          "y": 702.0,
          "width": 27.0,
          "height": 15.0
        }
      },
      {
        "percentage": 7.0,
        "location": {
          "x": 487.0,
          "y": 702.0,
          "width": 27.0,
          "height": 15.0
        }
      },
      {
        "percentage": 19.0,
        "location": {
          "x": 45.0,
          "y": 1007.0,
          "width": 30.0,
          "height": 15.0
        }
      },
      {
        "percentage": 19.0,
        "location": {
          "x": 45.0,
          "y": 1007.0,
          "width": 30.0,
          "height": 15.0
        }
      },
      {
        "percentage": 7.0,
        "location": {
          "x": 44.0,
          "y": 1031.0,
          "width": 26.0,
          "height": 15.0
        }
      },
      {
        "percentage": 7.0,
        "location": {
          "x": 44.0,
          "y": 1031.0,
          "width": 26.0,
          "height": 15.0
        }
      }
    ],
    "types": [
      "hotel",
      "parking",
      "gas",
      "plane",
      "taxi",
      "train",
      "public"
    ],
    "issuers": [
      {
        "issuer": "Motel One Berlin-Alexanderplatz",
        "location": {
          "x": 49.0,
          "y": 202.0,
          "width": 21.0,
          "height": 11.0
        }
      },
      {
        "issuer": "Motel One Berlin-Alexanderplatz",
        "location": {
          "x": 49.0,
          "y": 202.0,
          "width": 21.0,
          "height": 11.0
        }
      }
    ]
  };

//Call on load
window.onload = function() {

loadPaymentDate();
loadInvoiceIssuer();
loadInvoiceTypes(); 
loadInvoiceDate();
loadInvoiceNo();
loadVATAmounts();
loadVATPercentage(); 
loadNetAmount();
loadTotalAmount();



}


function loadPaymentDate(){
  
    for (var instance of text['dates']) {
      if(!(datesList.has(instance.date))){
        datesList.add(instance.date);
        var x = document.getElementById("paymentDate");
        var option = document.createElement("option");
        option.text = instance.date;
        option.value = instance.date;
        document.getElementById("paymentDate").appendChild(option);
/*
        var x = document.getElementById("paymentDate");
        var option = document.createElement("option");
        option.text = instance.date;
        x.add(option, x[0]);
*/
        //$('<option>' + instance.date + '</option>').appendTo('#paymentDate');
      }
    }
/*
    var paymentObject = document.getElementById("paymentDate");
    var payment = text['paymentDate'].date;
    paymentObject.value = payment;
    */
   //jQuery("#paymentDate option[value='"+text['paymentDate'].date+"' ]").attr("selected", true);

   document.querySelector("#paymentDate option[value='"+text['paymentDate'].date+"' ]").setAttribute('selected',true);
  document.getElementById("paymentD").value = text['paymentDate'].date;
}

var invoiceIssuers = new Set();
function loadInvoiceIssuer(){
  for (var instance of text['issuers']) {
    if(!(invoiceIssuers.has(instance.issuer))){
      invoiceIssuers.add(instance.issuer);
      //$('<option>' + instance.issuer + '</option>').appendTo('#issuer');
        var x = document.getElementById("issuer");
        var option = document.createElement("option");
        option.text = instance.issuer;
        option.value = instance.issuer;
        document.getElementById("issuer").appendChild(option);

        //x.add(option, x[0]);
    }
  }
/*
    var element = document.getElementById("issuer");
    element.value = text['invoiceIssuer'].issuer;
    */
   document.querySelector("#issuer option[value='"+text['invoiceIssuer'].issuer+"' ]").setAttribute('selected',true);
   document.getElementById("issuerD").value = text['invoiceIssuer'].issuer;
}


function loadInvoiceTypes(){
    var map = new Map();
    for(var item of text['types']){
        if(item in map){
            continue;
        }else{
            map[item]=1;
            //$('<option>' + item + '</option>').appendTo('#type');

            var x = document.getElementById("type");
            var option = document.createElement("option");
            option.text = item;
            option.value = item;
            //x.add(option, x[0]);
            document.getElementById("type").appendChild(option);
            }
        }
        /*
    var invoiceType = document.getElementById("type");
    invoiceType.value = text['invoiceType'];
*/

document.getElementById("typeD").value = text['invoiceType'];
}

var invoiceDates = new Set();
function loadInvoiceDate(){
  for (var instance of text['dates']) {
    if(!(invoiceDates.has(instance.date))){
      invoiceDates.add(instance.date);
      //$('<option>' + instance.date + '</option>').appendTo('#invoiceDate');

        var x = document.getElementById("invoiceDate");
        var option = document.createElement("option");
        option.text = instance.date;
        option.value = instance.date;
        document.getElementById("invoiceDate").appendChild(option);
        //x.add(option, x[0]);
    }
  }
  document.querySelector("#invoiceDate option[value='"+text['invoiceDate'].date+"' ]").setAttribute('selected',true);
   document.getElementById("invoiceDateD").value = text['invoiceDate'].date; 
}

function loadInvoiceNo(){
    var map ={};
    for(var item of text['ids']){
        if(!(item.id in map)){
            map[item.id]=1;
            //$('<option>' + item.id + '</option>').appendTo('#invoiceNo');
            var x = document.getElementById("invoiceNo");
            var option = document.createElement("option");
            option.text = item.id;
            option.value = item.id;
            document.getElementById("invoiceNo").appendChild(option);
            //x.add(option, x[0]);
            }

        }
       

document.querySelector("#invoiceNo option[value='"+text['invoiceId'].id+"' ]").setAttribute('selected',true);

document.getElementById("invoiceNoD").value = text['invoiceId'].id;
}

var uniqueVATAmounts = new Set();

function getUniqueVATAmounts(){
  for (var instance of text['amounts']) {
    if(!(uniqueVATAmounts.has(instance.amount))){
      uniqueVATAmounts.add(instance.amount);
    }
  }
}

function loadVATAmounts(){
  getUniqueVATAmounts();
  var setIter = uniqueVATAmounts.values();
  var count = 0;
  for(var i =0; i<uniqueVATAmounts.size; i++){
      var x = document.getElementsByClassName("vatAmountPre");
      var option = document.createElement("option");
      option.text = setIter.next().value;
      option.value = option.text;
      $('.vatAmountPre').appendChild(option);
      //$('.vatAmountPre').add(option);
     
  }
  /*
  var vatAmount = document.getElementsByClassName("vatAmountPre");
  vatAmount.value = text['vatAmounts'][0].amount;
*/
document.querySelector("#vatAmount option[value='"+text['vatAmounts'][0].amount.amount+"' ]").setAttribute('selected',true);
document.getElementById("vatAmountD").value = text['vatAmounts'][0].amount.amount;
}


function loadVATPercentage(){
  
  var map = {};
    for(var item of text['percentages']){
        if(!(item.percentage in map)){
            map[item.percentage]=1;
            //$('<option>' + item.percentage + '</option>').appendTo(document.getElementsByClassName("vatPerc"));
            var option = document.createElement("option");
            option.text = item.percentage;
            option.value = item.percentage;
            $('.vatPercPre').appendChild(option);
            }

        }
/*
  var vatPerc = document.getElementsByClassName("vatPercPre");
  vatPerc.value = text['vatAmounts'][0].percentage;
        */
       document.querySelector("#vatPerc option[value='"+text['vatAmounts'][0].percentage.percentage+"' ]").setAttribute('selected',true);
       document.getElementById("vatPercD").value = text['vatAmounts'][0].percentage.percentage;
}

function loadNetAmount(){
  var setIter = uniqueVATAmounts.values();
  for(var i =0; i<uniqueVATAmounts.size; i++){
    //$('<option>' + setIter.next().value + '</option>').appendTo(document.getElementById("netAmount"));
    var x = document.getElementById("netAmount");
        var option = document.createElement("option");
        option.text = setIter.next().value;
        option.value = option.text;
        document.getElementById("netAmount").appendChild(option);
        //x.add(option, x[0]);
  }

  //$('<option>' + text['totalAmount'].amount + '</option>').appendTo('#netAmount');
  var x = document.getElementById("netAmount");
  var option = document.createElement("option");
  option.text = text['totalAmount'].amount;
  option.value = text['totalAmount'].amount;
  document.getElementById("netAmount").appendChild(option);
  //x.add(option, x[0]);
  
  document.querySelector("#netAmount option[value='"+text['totalAmount'].amount+"' ]").setAttribute('selected',true);
  document.getElementById("netAmountD").value = text['totalAmount'].amount;
  
}

function loadTotalAmount(){
  //$('<option>' + text['totalAmount'].amount + '</option>').appendTo('#totalAmount');
  var x = document.getElementById("totalAmount");
  var option = document.createElement("option");
  option.text = text['totalAmount'].amount;
  option.value = text['totalAmount'].amount;
  document.getElementById("totalAmount").appendChild(option);

  document.getElementById("totalAmountD").value = text['totalAmount'].amount;
  document.querySelector("#totalAmount option[value='"+text['totalAmount'].amount+"' ]").setAttribute('selected',true);
};


document.querySelector('body').addEventListener("click", function(event){

  //Dodaje se novi vat
  if (event.target.value === 'add') {
    var row = event.target.parentElement.parentElement.parentElement.rowIndex;
  
    var table = document.getElementById("mainTable");

    //dodaj i event listener da selektuje 
  

        var table = document.getElementById("mainTable");
        var vatAmount = document.getElementById("vatAmountPre");
        var vatPerc = document.getElementById("vatPercPre");
  
        var amountClone = vatAmount.cloneNode(true);
        var percClone = vatPerc.cloneNode(true);
        var middleRow = table.insertRow(row);
  
        middleRow.appendChild(amountClone);
        middleRow.appendChild(percClone);
  
        document.getElementsByClassName("deleteButton").disabled = false;
        }
        displayDropdownOptions();
  


  //}
});

    function deleteRow(){
    
        var table = document.getElementById("mainTable");
        var rowCount = table.rows.length -4;
        if(table.rows.length <=7){
            document.getElementsByClassName("deleteButton").disabled = true;
            document.getElementsByClassName("addButton").disabled = false;
        }else{
            var tr = table.deleteRow(rowCount);
            document.getElementsByClassName("addButton").disabled = false;
        }

    }

    function goToConfirmPage(){
      var paymentDate = document.getElementById("paymentD").value;
      var invoiceIssuer = document.getElementById("issuerD").value;
      var invoiceType = document.getElementById("typeD").value;
      var invoiceDate = document.getElementById("invoiceDateD").value;
      var invoiceNo = document.getElementById("invoiceNoD").value;
      var netAmount = document.getElementById("netAmountD").value;
      var totalAmount = document.getElementById("totalAmountD").value;

      var countOfVAT = document.getElementsByClassName("vatAmountPre").length;
      var vatAmount = new Map();

      /*
      var amounts = document.getElementsByClassName("vatAmountPre");
      var percentages = document.getElementsByClassName("vatPercPre");
*/
      var amounts = document.getElementsByName("vatAmountD");
      var percentages = document.getElementsByName("vatPercD");

      var counter = 1;

      for(var i = 1; i<countOfVAT; i++){
        /*
        var selectedAmount = amounts.item(counter).selectedIndex;
        var selectedPerc =  percentages.item(counter).selectedIndex;

        var text = amounts.item(counter).options[selectedAmount].text;
        var text1 = percentages.item(counter).options[selectedPerc].text;
        */

       var text = amounts.item(counter).value;
       var text1 = percentages.item(counter).value;
        counter++;

        var table = document.getElementById("dataSummary");


        var row = table.insertRow();
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        cell1.innerHTML = "VAT Percentage";
        cell2.innerHTML = text1 + "%" ;

        var row2 = table.insertRow();
        var cell3 = row2.insertCell(0);
        var cell4 = row2.insertCell(1);
        cell3.innerHTML = "VAT Amount";
        cell4.innerHTML = text;




      
      }

    /*
      var VATs  = $('#vatAmount').options[$('#vatAmount').selectedIndex].text;
      var VATsPerc  = $('#vatPerc').options[$('#vatPerc').selectedIndex].text;
      */

      var VATs = $('#vatAmountD').value;
      var VATsPerc = $('#vatPercD').value;
      vatAmount[VATs] = VATsPerc;


      var dataArray = new Array();
      dataArray.push(paymentDate,invoiceIssuer,invoiceType,invoiceDate,invoiceNo,vatAmount,netAmount,totalAmount);


document.getElementById('paymentDateExp').innerHTML = document.getElementById('invoiceNoExp').innerHTML +dataArray[0];
document.getElementById('invoiceIssuerExp').innerHTML = document.getElementById('invoiceIssuerExp').innerHTML +dataArray[1];
document.getElementById('invoiceTypeExp').innerHTML = document.getElementById('invoiceTypeExp').innerHTML +dataArray[2];
document.getElementById('invoiceDateExp').innerHTML = document.getElementById('invoiceDateExp').innerHTML +dataArray[3];
document.getElementById('invoiceNoExp').innerHTML = document.getElementById('invoiceNoExp').innerHTML +dataArray[4];
document.getElementById('vatAmountExp').innerHTML = document.getElementById('vatAmountExp').innerHTML + Object.keys(dataArray[5]);
document.getElementById('vatPercExp').innerHTML = document.getElementById('vatPercExp').innerHTML + dataArray[5][VATs] + '%';
document.getElementById('netAmountExp').innerHTML = document.getElementById('netAmountExp').innerHTML +dataArray[6];
document.getElementById('totalAmountExp').innerHTML = document.getElementById('totalAmountExp').innerHTML +dataArray[7];
    }


    function exportData(){
      $("#Page2").style.display = 'none';
      $("#Page3").style.display = 'block';
    }

//Used to display all values form the drop down menu at any point
function displayDropdownOptions(){
  var oldValue = '';

jQuery('input').on('click', function() {
  oldValue = jQuery(this).val();
  jQuery(this).val('');
});

// Restore current value after click
jQuery('input').on('mouseleave', function() {
  if (jQuery(this).val() == '') {
    jQuery(this).val(oldValue);
  }
});
}





    
    